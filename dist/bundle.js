(()=>{"use strict";var t={769:function(t,e){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});e.__esModule=!0,e.cellTypeFromNumber=e.Building=e.CellType=e.Cell=e.World=void 0;var r=Object.freeze({Empty:Symbol("Empty"),ResidentialBuilding:Symbol("ResidentialBuilding"),Road:Symbol("Road"),Factory:Symbol("Factory"),Shop:Symbol("Shop"),Storage:Symbol("Storage"),CityDecor:Symbol("CityDecor")});function i(t){var e=12*t[0]+t[1];return 0==e?r.Empty:[47,71].includes(e)?r.Storage:[46,54,56,66,69].includes(e)?r.Shop:[1,48,49,50,51,52,53].includes(e)?r.CityDecor:[64,65,68].includes(e)?r.Factory:e<54?r.Road:r.ResidentialBuilding}e.CellType=r,e.cellTypeFromNumber=i;var a=function(){function t(t){this.map=t}return t.fromTextureArray=function(e){for(var n=[],o=0;o<e.length;o++){for(var r=[],a=0;a<e[0].length;a++)r.push(new s({x:e[o][a][1],y:e[o][a][0]},{x:o,y:a},i(e[o][a])));n.push(r)}return new t(n)},t.prototype.tick=function(){},t.prototype.getCell=function(t){if(!this.isValid(t))throw new Error("Position not valid: ".concat(t));return this.map[t.x][t.y]},t.prototype.setCell=function(t){this.map[t.pos.x][t.pos.y]=t},t.prototype.isValid=function(t){return t.x>=0&&t.x<this.map.length&&t.y>=0&&t.y<this.map[0].length},t.prototype.getSurroundingCells=function(t,e,n){e=-1==e?Number.MAX_VALUE:e;var o=[],r=new Set,i=[];for(i.push(t.pos);i.length>0&&e>0;){for(var a=[];i.length>0;){var s=i.pop();if(this.isValid(s)&&!r.has(s)){r.add(s);var l=this.getCell(s);(0===n.size||n.has(l.type))&&o.push(l);for(var c=0,u=[{x:l.pos.x-1,y:l.pos.y},{x:l.pos.x+1,y:l.pos.y},{x:l.pos.x,y:l.pos.y-1},{x:l.pos.x,y:l.pos.y+1}];c<u.length;c++){var d=u[c];r.has(d)||a.push(d)}}}i=a,e--}return o},t}();e.World=a;var s=function(t,e,n){this.texture=t,this.pos=e,this.type=n};e.Cell=s;var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(s);e.Building=l},607:function(t,e,n){var o=this&&this.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(e,n);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,o,r)}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),r=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||o(e,t,n)};e.__esModule=!0,r(n(562),e),r(n(519),e),r(n(769),e)},519:(t,e,n)=>{e.__esModule=!0;var o,r,i,a,s,l,c,u,d,f,p,y,h,v=n(769),g=n(562),x=function(t){return document.querySelector(t)},b=1,m=[0,0],w=new g.UI,S="BUILD",C=new Image;C.src="textures/bg.png",C.onload=function(t){return _()};var _=function(){l=[0,0];var t=[];console.log("Starting with k=".concat(10));for(var e=0;e<10;e++){for(var n=[],g=0;g<10;g++)n.push([0,0]);t.push(n)}b=1,u={x:-650,y:-50},o=x("#drawing-container"),r=x("#bg"),a=x("#fg"),i=r.getContext("2d"),s=a.getContext("2d"),window.addEventListener("resize",T),d=t.length,f=128,p=64,y=12,6,E(t,document.location.hash.substring(1)),h=v.World.fromTextureArray(t),T(),a.addEventListener("mousemove",D),a.addEventListener("contextmenu",(function(t){return t.preventDefault()})),a.addEventListener("mouseup",B),a.addEventListener("mousedown",j),a.addEventListener("wheel",P),addEventListener("keydown",M),setInterval(L,1e3/30),function(){for(var t=x("#tools"),e=0,n=function(n){for(var o=function(o){var r,i=(r="div",document.createElement(r));i.id="tool_".concat(e++),i.style.display="block",i.style.backgroundPosition="-".concat(130*o+2,"px -").concat(230*n,"px"),i.addEventListener("click",(function(t){l=[n,o],c&&x("#".concat(c)).classList.remove("selected"),c=t.target.id,x("#".concat(c)).classList.add("selected")})),t.appendChild(i)},r=0;r<y;r++)o(r)},o=0;o<6;o++)n(o)}()};function L(){!function(){k(i),i.save(),i.scale(b,b);for(var t=0;t<d;t++)for(var e=0;e<d;e++)O(i,t,e,h.map[t][e].texture.y,h.map[t][e].texture.x);i.restore()}(),function(){k(s);var t="rgba(0,0,0,0.2)";"DETAILS"===S&&(t="rgba(11,127,171,0.3)"),m.x>=0&&m.x<d&&m.y>=0&&m.y<d&&I(s,m.x,m.y,t)}(),h.tick()}function T(){r.width=o.offsetWidth,r.height=o.offsetHeight,a.width=r.width,a.height=r.height}var E=function(t,e){for(var n=atob(e).split("").map((function(t){return t.charCodeAt(0)})),o=0,r=0;r<d;r++)for(var i=0;i<d;i++){var a=n[o++]||0,s=Math.trunc(a/y),l=Math.trunc(a%y);t[r][i]=[s,l]}};function k(t){t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,r.width,r.height),t.restore()}var I=function(t,e,n,o){t.save(),t.scale(b,b),t.translate((n-e)*f/2-u.x,(e+n)*p/2-u.y),t.beginPath(),t.moveTo(0,0),t.lineTo(f/2,p/2),t.lineTo(0,p),t.lineTo(-f/2,p/2),t.closePath(),t.fillStyle=o,t.fill(),t.restore()},O=function(t,e,n,o,r){t.save(),t.translate((n-e)*f/2-u.x,(e+n)*p/2-u.y),r*=130,o*=230,t.drawImage(C,r,o,130,230,-65,-130,130,230),t.restore()},A=function(t){var e=t.offsetX/b,n=(t.offsetY/b+u.y)/p,o=(e+u.x)/f;return{x:Math.floor(n-o),y:Math.floor(o+n)}};function D(t){m=A(t)}function M(t){var e=100;switch(t.keyCode){case 38:u.y-=e;break;case 40:u.y+=e;break;case 37:u.x-=e;break;case 39:u.x+=e}}function P(t){t.preventDefault(),t.deltaY<0?b-=.006:t.deltaY>0&&(b+=.006),b>1.3&&(b=1.3),b<.5&&(b=.5)}var j=function(t){var e=A(t);if(e.x>=0&&e.x<d&&e.y>=0&&e.y<d){if("BUILD"===S)return h.setCell(new v.Cell({x:l[1],y:l[0]},e,(0,v.cellTypeFromNumber)(l))),void function(){for(var t=0,e=new Uint8Array(d*d),n=0;n<d;n++)for(var o=0;o<d;o++)e[t++]=h.map[n][o].texture.y*y+h.map[n][o].texture.x;var r=function(t){return btoa(String.fromCharCode.apply(null,t))}(e);history.replaceState(void 0,void 0,"#".concat(r))}();if("DETAILS"!==S);else{for(var n=h.getCell(e),o=h.getSurroundingCells(n,2,new Set),r=0,i=o;r<i.length;r++){var a=i[r];I(s,a.pos.x,a.pos.y,"rgba(11, 127, 171,0.2)")}w.infoTab.showCellInfo(n,"Cells around=[".concat(o.map((function(t){return t.type.description})).join(", "),"]"))}}},B=function(){};window.activateTab=function(t){for(var e=t.getAttribute("data-tab"),n=0,o=x("#instruments").children;n<o.length;n++)(a=o[n]).style.display="none";for(var r=0,i=x("#btns").children;r<i.length;r++){var a;(a=i[r]).classList.remove("btn-dark"),a.classList.add("btn-outline-dark")}switch(t.classList.remove("btn-outline-dark"),t.classList.add("btn-dark"),x(e).style.display="flex",e){case"#tools":S="BUILD";break;case"#details":S="DETAILS"}}},562:(t,e)=>{e.__esModule=!0,e.UI=void 0;e.UI=function(){this.infoTab=new n};var n=function(){function t(){this.el=$(t.selector)[0]}return t.prototype.showCellInfo=function(t,e){this.el.innerHTML='\n            <table class="table table-sm">\n                <tr>\n                    <td>Type</td>\n                    <td>'.concat(t.type.description,"</td>\n                </tr>\n                <tr>\n                    <td>Position</td>\n                    <td>").concat(JSON.stringify(t.pos),"</td>\n                </tr>\n                <tr>\n                    <td>Additional info</td>\n                    <td>").concat(e,"</td>\n                </tr>\n            </table>\n        ")},t.selector="#details",t.noContent="<p>Pick cell to inspect</p>",t}()}},e={};!function n(o){var r=e[o];if(void 0!==r)return r.exports;var i=e[o]={exports:{}};return t[o].call(i.exports,i,i.exports,n),i.exports}(607)})();